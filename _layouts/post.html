<!doctype html>
<html lang="en">
  <head>
    <title>Anthony Cossins</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Anthony Cossins has a website on the internet and this is it.">
    <meta name="keywords" content="just, a, great, guy">

    <link rel="stylesheet" href="/assets/css/reset.css">
    <link rel="stylesheet" href="/assets/css/vars.css">
    <link rel="stylesheet" href="/assets/css/body.css">
    <link rel="stylesheet" href="/assets/css/post.css">
    <link rel="stylesheet" href="/assets/css/theme-toggle.css">
    <link rel="stylesheet" href="/assets/css/header.css">
    <link rel="stylesheet" href="/assets/css/iframe.css">
  </head>
  <body class="body js-body">
    <header class="header">
      <a class="header__logo"href="/">
        <img src="https://anthonycossins.com/assets/images/blink_animation.gif" class="logo" alt="A head as a logo">
      </a>

      <nav class="header__nav">
        <a class="header__nav-link header__nav-link--posts" href="/posts">Posts</a>
        <a class="header__nav-link header__nav-link--about" href="/#about">About</a>
      </nav>

      <noscript>
        <style>
          .theme-toggle {
            display: none;
          }
        </style>
      </noscript>
      <button class="header__nav-link header__nav-link--fixed theme-toggle js-dark-mode">
        <img class="theme-toggle__icon theme-toggle__icon--dark" src="/assets/images/moon.svg">
        <img class="theme-toggle__icon theme-toggle__icon--light" src="/assets/images/sun.svg">
      </button>
    </header>
    <article class="post">
      <div class="contain">
        {{ content }}
      </div>
    </article>
  </body>

  <script>
    const localStorageTheme = localStorage.getItem('theme');

    const state = {
      theme: localStorageTheme ? localStorageTheme : 'light'
    };

    const $body = document.querySelector('.js-body');
    const $darkModeButton = document.querySelector('.js-dark-mode');

    function createRender(renderFunc = () => {}) {
      let lastStateString = '';

      return function() {
        const newStateString = JSON.stringify(state);

        if (newStateString === lastStateString) {
          return;
        }

        lastStateString = newStateString;

        renderFunc();
      }
    }

    const render = createRender(() => {
      $body.setAttribute('data-theme', state.theme);
      localStorage.setItem('theme', state.theme);

      $darkModeButton.querySelectorAll('img').forEach((img) => {
        img.style.display = 'none';
      });

      if (state.theme === 'dark') {
        $darkModeButton.querySelector('img[src*="sun"').style.display = 'block';
      }

      if (state.theme === 'light') {
        $darkModeButton.querySelector('img[src*="moon"').style.display = 'block';
      }
    });

    $darkModeButton.addEventListener('click', (evt) => {
      evt.preventDefault();

      state.theme = state.theme === 'light' ? 'dark' : 'light';

      render();
    });

    render();
  </script>
</html>
