---
layout: snippet
title: Canvas odometer
description: Canvas odometer
---
<!--
Created using JS Bin
http://jsbin.com

Copyright (c) 2017 by Anthonyec (http://jsbin.com/ladeyey/29/edit)

Released under the MIT license: http://jsbin.mit-license.org
-->

<style id="jsbin-css">
  body {
    background: black;
  }

  canvas {
    outline: 1px solid black;
  }
</style>

<div class="app">
  <canvas id="canvas"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/lodash/4/lodash.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.6.5/dat.gui.js"></script>
<script id="jsbin-javascript">
  const PIXEL_RATIO = window.devicePixelRatio || 1;

  const $ranges = document.querySelectorAll('.range');
  const $canvas = document.getElementById('canvas');
  const context = $canvas.getContext('2d');

  $canvas.width = 600;
  $canvas.height = 600;
  $canvas.style.width = '300px';
  $canvas.style.height = '300px';

  context.scale(PIXEL_RATIO, PIXEL_RATIO);

  let DEFAULT_PROPS = {
    x: 150,
    y: 160,
    radius: 100,
    total: 31,
    startAngle: -30,
    endAngle: 210,
    dashLength: 10,
    dashMinorLength: 15,
    dashMajorLength: 20,
    showOutline: false,
  };

  const toRadians = (angle) => {
    return angle * (Math.PI / 180);
  }

  const toDegrees = (angle) => {
    return angle * (180 / Math.PI);
  }

  const interpolate = (min, max, t) => {
    return min + (max - min) * t;
  }

  const offsetBy = (angle, distance) => {
    const { radius } = DEFAULT_PROPS;

    return {
      x: Math.cos(angle) * (radius + distance),
      y: Math.sin(angle) * (radius + distance),
    };
  }

  const getPosition = (index) => {
    const { radius, total, startAngle, endAngle, length } = DEFAULT_PROPS;

    const angleDiff = toRadians(endAngle - startAngle);
    const offset = toRadians(startAngle);

    const unit = 1 / (total - 1);
    const ramp = index * unit;
    const angle = (Math.PI + ramp * (angleDiff)) + offset;

    const x = Math.cos(angle) * radius;
    const y = Math.sin(angle) * radius;

    return {
      x,
      y,
      angle: toDegrees(angle),
      offsetBy: offsetBy.bind(this, angle),
    };
  }

  const draw = () => {
    context.fillStyle = '#000000';
    context.fillRect(0, 0, 400, 400);
    context.fillStyle = '#ffffff';

    _.times(DEFAULT_PROPS.total, (i) => {
      const position = getPosition(i);
      let positionOffset = position.offsetBy(-DEFAULT_PROPS.dashLength);

      context.beginPath();
      context.strokeStyle = 'silver';
      context.lineWidth = 1;

      if (i % 10 === 0) {
        context.strokeStyle = 'white';
        positionOffset = position.offsetBy(-DEFAULT_PROPS.dashMajorLength);
        context.lineWidth = 2;
      }

      if (i % 5 === 0 && i % 10 !== 0) {
        context.strokeStyle = 'white';
        positionOffset = position.offsetBy(-DEFAULT_PROPS.dashMinorLength);
        context.lineWidth = 2;
      }

      context.moveTo(DEFAULT_PROPS.x + position.x, DEFAULT_PROPS.y + position.y);
      context.lineTo(DEFAULT_PROPS.x + positionOffset.x, DEFAULT_PROPS.y + positionOffset.y);
      context.stroke();
    });

    if (DEFAULT_PROPS.showOutline) {
      context.beginPath();
      context.lineWidth = 2;
      context.strokeStyle = 'white';
      context.arc(
        DEFAULT_PROPS.x,
        DEFAULT_PROPS.y,
        DEFAULT_PROPS.radius -1,
        -toRadians(DEFAULT_PROPS.endAngle),
        interpolate(-toRadians(DEFAULT_PROPS.endAngle), -toRadians(DEFAULT_PROPS.startAngle), 1)
      );
      context.stroke();
    }
  }

  draw();

  window.onload = () => {
    const gui = new dat.GUI();

    gui.add(DEFAULT_PROPS, 'total', 0, 181);
    gui.add(DEFAULT_PROPS, 'radius', 0, 300);
    gui.add(DEFAULT_PROPS, 'startAngle', -90, 90);
    gui.add(DEFAULT_PROPS, 'endAngle', 90, 270);
    gui.add(DEFAULT_PROPS, 'dashLength', 0, 100);
    gui.add(DEFAULT_PROPS, 'dashMinorLength', 0, 100);
    gui.add(DEFAULT_PROPS, 'dashMajorLength', 0, 100);
    gui.add(DEFAULT_PROPS, 'showOutline');

    gui.onChange = function(f) {
      var i, j;
      for (i in this.__controllers) this.__controllers[i].onChange (f);
      for (i in this.__folders) for (j in this.__folders[i].__controllers) this.__folders[i].__controllers[j].onChange (f);
    };

    gui.onChange(draw);
  };

</script>
